<!-- File: show_profile.html
  Author: María Díaz Garrido
  Description: Template used by ProfileDetailView to render a single Profile.
               Inherits from mini_insta/base.html and displays the profile image,
               username, optional display_name, and bio_text, plus a link back
               to the profiles list.
-->

{% extends "mini_insta/base.html" %}

{% block title %}{{ profile.display_name|default:profile.username }} · Profile{% endblock %}

{% block content %}
  <article class="profile-detail">
    <img
      src="{{ profile.profile_image_url }}"
      alt="{{ profile.display_name|default:profile.username }}'s profile image"
      class="profile-image"
    >
    <h2>@{{ profile.username }}</h2>

    {% if profile.display_name %}
      <p class="muted">{{ profile.display_name }}</p>
    {% endif %}

    {% if profile.bio_text %}
      <p>{{ profile.bio_text }}</p>
    {% endif %}
  </article>

    <!-- Display the posts about this profile -->
    <!-- {{post.get_all_posts}} -->
 {% for post in profile.get_all_posts %}
    <div class="post">
      <strong>by {{ post.profile.username|default:post.profile }} · {{ post.published }}</strong>
      <p>{{ post.caption }}</p>

      {# first photo if any; else fallback #}
      {% with first_photo=post.get_all_photos|first %}
        {% if first_photo %}
          <img src="{{ first_photo.image_url }}" alt="Photo for this post" class="post-photo">
        {% else %}
        <img src="https://static.vecteezy.com/system/resources/previews/022/059/000/non_2x/no-image-available-icon-vector.jpg"
         alt="No image available" class="post-photo">
  {% endif %}
      {% endwith %}
    </div>
  {% empty %}
    <p class="muted">No posts yet.</p>
  {% endfor %}


  <p><a href="{% url 'mini_insta:show_all_profiles' %}">&larr; Back to all profiles</a></p>
{% endblock %}
