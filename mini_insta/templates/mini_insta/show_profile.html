<!-- File: show_profile.html
  Author: María Díaz Garrido
  Description: Template used by ProfileDetailView to render a single Profile.
               Inherits from mini_insta/base.html and displays the profile image,
               username, optional display_name, and bio_text, plus a link back
               to the profiles list.
-->

{% extends "mini_insta/base.html" %}

{% block title %}{{ profile.display_name|default:profile.username }} Profile{% endblock %}

{% block content %}
  <article class="profile-detail card">
    <div class="row">
      <img
        src="{{ profile.profile_image_url }}"
        alt="{{ profile.display_name|default:profile.username }}'s profile image"
        class="avatar"
      >
      <div class="stack-sm">
        <h2 style="margin:0">{{ profile.display_name|default:profile.username }}</h2>
        <div class="muted">@{{ profile.username }}</div>

        <a class="btn btn-primary" href="{% url 'mini_insta:update_profile' pk=profile.pk %}">Update Profile</a>
      </div>
    </div>

    <div class="stats">
    <a href="{% url 'mini_insta:profile_followers' profile.pk %}">
      <strong>{{ profile.get_num_followers }}</strong> follower{{ profile.get_num_followers|pluralize }}
    </a>
    &nbsp;|&nbsp;
    <a href="{% url 'mini_insta:profile_following' profile.pk %}">
      <strong>{{ profile.get_num_following }}</strong> following
    </a>
  </div>

    {% if profile.bio_text %}
      <p style="margin-top:1rem">{{ profile.bio_text }}</p>
    {% endif %}


  </article>

  {% for post in profile.get_all_posts %}
    <div class="post" style="margin-top:1rem">
      <strong>by {{ post.profile.username|default:post.profile }} · {{ post.published }}</strong>

      <p>
        <a href="{% url 'mini_insta:show_post' post.pk %}">
          {{ post.caption }}
        </a>
      </p>

      {% with first_photo=post.get_all_photos|first %}
        {% if first_photo and first_photo.get_image_url %}
          <a href="{% url 'mini_insta:show_post' pk=post.pk %}">
            <img src="{{ first_photo.get_image_url }}" alt="First photo for Post {{ post.pk }}" class="rounded">
          </a>
        {% else %}
          <a href="{% url 'mini_insta:show_post' pk=post.pk %}">
            <img src="https://placehold.co/600x400?text=No+Image" alt="No image available" class="rounded">
          </a>
        {% endif %}
      {% endwith %}
    </div>
  {% empty %}
    <p class="muted">No posts yet.</p>
  {% endfor %}

  <p style="margin-top:1rem;">
    <a class="btn btn-outline" href="{% url 'mini_insta:show_all_profiles' %}">&larr; Back to all profiles</a>
  </p>
{% endblock %}

